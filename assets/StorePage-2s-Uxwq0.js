import{j as e,u as T,r as n,b as D,f as $,c as p}from"./index-BWStPa2h.js";import{n as l}from"./feedback-CHygJqFt.js";import{S as z}from"./store-CiAz0xQm.js";import{u as G}from"./AuthChecker-BxEdAQ6N.js";import{f as K}from"./index-rN5PxlGS.js";import{c as w,m as d}from"./createLucideIcon-BqLr22Er.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]],Y=w("MessageCircle",O);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]],Z=w("Scan",V);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]],U=w("ShoppingCart",J),W=({message:x})=>e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-dashed rounded-full animate-spin"}),e.jsx("p",{className:"mt-2 text-gray-600",children:x})]}),X=()=>{const{showChatBot:x,toggleChatBot:f}=T(),[m,y]=n.useState([{text:"Hello! How can I assist you today?",sender:"bot"}]),[c,r]=n.useState("");if(!x)return null;const b=()=>{if(!c.trim())return;const a=[...m,{text:c,sender:"user"}];y(a),r(""),setTimeout(()=>{y(g=>[...g,{text:"I'm just a simple bot. Try asking something else!",sender:"bot"}])},1e3)};return e.jsxs("div",{className:"fixed bottom-6 right-6 w-80 h-96 bg-gray-900 text-white shadow-lg rounded-lg p-4 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h2",{className:"text-lg font-bold",children:"ChatBot"}),e.jsx("button",{onClick:f,className:"text-red-500",children:e.jsx(K,{})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-800 p-2 rounded-lg",children:m.map((a,g)=>e.jsx("p",{className:`p-2 my-1 rounded-lg ${a.sender==="user"?"bg-blue-600 text-right":"bg-gray-700"}`,children:a.text},g))}),e.jsx("input",{type:"text",placeholder:"Type a message...",className:"w-full p-2 mt-2 bg-gray-700 text-white rounded-lg border border-gray-600 focus:outline-none",value:c,onChange:a=>r(a.target.value),onKeyDown:a=>a.key==="Enter"&&b()})]})},ne=()=>{const{cartId:x,cart:f,setCart:m}=D(),{redirectTo:y}=G(),c=$(),[r,b]=n.useState(null),[a,g]=n.useState([]),[F,k]=n.useState(!0),[S,M]=n.useState(null),[ee,C]=n.useState(!1),[j,P]=n.useState(!1),N=localStorage.getItem("store"),{toggleChatBot:_,spendingLimit:o}=T(),H=async()=>{if(!N){l.error("No store session found."),c("/");return}k(!0);try{const t=await z.getStoreDetails(N),s=await p.getProductDetails({cartId:x});b(t.data.store),g(s.data)}catch{M("Failed to load store details."),l.error("Failed to load store details.")}finally{k(!1)}};n.useEffect(()=>{H()},[x,N]);const Q=async t=>{try{const{data:s}=await p.addToCart({productId:t,quantity:1});m(i=>({...i,items:s.cart.items}))}catch{l.error("Failed to update quantity.")}},E=async t=>{try{await p.addToCart({productId:t,quantity:-1}),console.log(f),m(s=>s.map(i=>i._id===t?{...i,Quantity:Math.max(0,i.Quantity-1)}:i))}catch{l.error("Failed to update quantity.")}},I=async t=>{try{await p.removeFromCart(t),m(s=>s.filter(i=>i._id!==t)),l.success("Product removed from cart.")}catch{l.error("Failed to remove product.")}},A=()=>{y("/scan"),l.info("Scanning product...")},q=async()=>{C(!0);try{l.success("Checkout successful!"),c("/recipt")}catch{l.error("Checkout failed. Please try again.")}finally{C(!1)}},B=()=>{if(!Array.isArray(a)||a.length===0)return{subtotal:0,gst:0,total:0};const t=a.reduce((v,h)=>v+(h.Price||0)*(h.Quantity||0),0),s=a.reduce((v,h)=>v+(h.Price||0)*(h.Quantity||0)*((h.Tax||0)/100),0),i=t+s;return{subtotal:Number(t.toFixed(2)),gst:Number(s.toFixed(2)),total:Number(i.toFixed(2))}},{subtotal:L,gst:R,total:u}=B();return n.useEffect(()=>{o&&(u>o&&!j?(l.warning(`You have exceeded your spending limit of  ₹${o}. Please review your cart.`),P(!0)):u<=o&&j&&P(!1),u>=o*.9&&u<o&&l.info(`You're close to your spending limit of  ₹${o}. Keep an eye on your cart!`))},[u,o,j]),S?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-100 p-4 dark:bg-gray-900",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:"Error"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:S}),e.jsx("button",{onClick:()=>c("/"),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all",children:"Go Back Home"})]}):F?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100 dark:bg-gray-900",children:e.jsx(W,{message:"Loading store details..."})}):e.jsxs("div",{className:"min-h-screen bg-gray-50/80 backdrop-blur-sm p-4 sm:p-6",children:[e.jsxs(d.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"max-w-4xl mx-auto bg-white/20 backdrop-blur-lg rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:r==null?void 0:r.StoreName}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:r==null?void 0:r.StoreAddress})]}),e.jsx("div",{className:"mt-3 sm:mt-0 bg-purple-600 text-white px-4 py-2 rounded-lg shadow-md",children:e.jsxs("p",{className:"text-sm",children:["Operating Hours: ",r==null?void 0:r.OperatingHours]})})]}),e.jsxs(d.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"mt-8",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-6 border-b-2 border-purple-500 pb-2",children:"Available Products"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:a.map(t=>{const s=(t.Price*t.Quantity*(1+t.Tax/100)).toFixed(2);return e.jsxs(d.div,{whileHover:{scale:1.03},className:"bg-gradient-to-br from-white/40 to-gray-100/50 backdrop-blur-lg rounded-xl p-5 shadow-xl border border-gray-300",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:t.Name}),e.jsxs("div",{className:"my-4 space-y-2",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Price:"})," ₹",t.Price]}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Quantity:"})," ",t.Quantity]}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Tax:"})," ",t.Tax,"%"]}),e.jsxs("p",{className:"text-base font-semibold text-gray-900",children:[e.jsx("span",{className:"text-gray-800",children:"Total:"})," ₹",s]})]}),e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>E(t._id),className:"px-3 py-1.5 bg-gray-700 text-white rounded-lg hover:bg-gray-800 transition",children:"-"}),e.jsx("span",{className:"text-lg font-medium",children:t.Quantity}),e.jsx("button",{onClick:()=>Q(t._id),className:"px-3 py-1.5 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"+"})]})}),e.jsx("button",{onClick:()=>I(t._id),className:"w-full py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-all shadow-md",children:"Remove"})]},t._id)})})]}),e.jsxs(d.div,{initial:{opacity:0},animate:{opacity:1},className:"mt-8 bg-white/20 backdrop-blur-lg rounded-xl p-6 shadow-lg",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Payment Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-gray-700",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{className:"text-gray-900",children:[" ₹",L.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-gray-700",children:[e.jsx("span",{children:"GST (7%):"}),e.jsxs("span",{className:"text-gray-900",children:[" ₹",R.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-gray-900 font-bold border-t pt-3",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:[" ₹",u.toFixed(2)]})]})]})]}),e.jsxs("div",{className:" bottom-4 right-4 flex item-center items-center justify-center gap-3 flex-col mt-5 md:items-end",style:{right:"-156px"},children:[e.jsxs(d.button,{whileHover:{scale:1.05},className:"px-3 py-2 bg-purple-600 text-white rounded-full shadow-lg flex items-center justify-between w-[168px] gap-4 mt-2",onClick:A,children:[e.jsx(Z,{className:"mr-2"}),"Scan Product"]}),e.jsxs(d.button,{whileHover:{scale:1.05},className:"px-3 py-2 bg-blue-600 text-white rounded-full shadow-lg flex items-center w-[168px] gap-4 mt-2",onClick:q,children:[e.jsx(U,{className:"mr-2"}),"Checkout"]}),e.jsxs(d.button,{whileHover:{scale:1.05},className:"px-3 py-2  text-white rounded-full shadow-lg flex items-center justify-center  bg-teal-600 hover:bg-teal-700   w-[168px] gap-4 mt-2",onClick:_,children:[e.jsx(Y,{className:"mr-2"}),e.jsx("span",{className:"relative right-4",children:"Chat"})]})]})]}),e.jsx(X,{})]})};export{ne as default};
